#!/usr/bin/env bash

set -euo pipefail

SCRIPT_PATH="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"


DOT_FILE_NAMES=(
    ".gitconfig"
    ".gitignore_global"
    ".zshrc"
    ".zshrc.local"
    ".zshrc_aliases"
    "Brewfile"
    ".git_aliases"
)

link_dotfiles() {
    for filename in "${DOT_FILE_NAMES[@]}"; do
        source_file="$SCRIPT_PATH/$filename"
        target_file="$HOME/$filename"

        if [ ! -f "$source_file" ]; then
            echo "Source file '$source_file' does not exist. Skipping..."
            continue
        fi

        # Backup existing file if it exists and is not a symlink
        if [ -e "$target_file" ] && [ ! -L "$target_file" ]; then
            backup_file="$target_file.backup.$(date +%Y%m%d_%H%M%S)"
            echo "Backing up existing file to '$backup_file'"
            mv "$target_file" "$backup_file"
        fi

        ln -sf -v "$source_file" "$target_file"
    done
}

unlink_dotfiles() {
    for filename in "${DOT_FILE_NAMES[@]}"; do
        dotfile="$HOME/$filename"
        rm -f -v "$dotfile"
    done
}

update_links() {
    echo "Removing symlinks..."
    unlink_dotfiles

    echo "Creating symlinks..."
    link_dotfiles
}

update_links
